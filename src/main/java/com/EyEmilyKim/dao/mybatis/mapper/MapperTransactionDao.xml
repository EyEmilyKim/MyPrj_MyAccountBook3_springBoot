<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.EyEmilyKim.dao.TransactionDao">

  <select id="getMaxMySqn" resultType="Integer">
	select max(MY_SEQNO) from MAB_TRANSACTIONS 
	<where> 
	USER_ID = #{userId} 
	</where> 
  </select>

  <insert id="insert" parameterType="com.EyEmilyKim.entity.Transaction">
  	insert into MAB_TRANSACTIONS values(
  	 #{user_id}, #{my_seqno}, 
  	 #{tran_id}, #{tran_date}, 
  	 #{inex}, #{cate_code}, 
  	 #{item}, #{amount}, 
  	 #{mncrd}, #{meth_code}, 
  	 #{reg_date} )
  </insert>

  <select id="getListAll" parameterType="com.EyEmilyKim.dto.TranSearchDto" resultType="com.EyEmilyKim.dto.TransactionDto">
	select * from MAB_TRANSACTIONS_VIEW
    <where>
        USER_ID = #{user_id} 
        <if test="TS_FROM != null">
            AND TRAN_DATE >= #{TS_FROM} 
        </if>
        <if test="TS_TO != null">
            and TRAN_DATE &lt;= #{TS_TO} 
        </if>
        <if test="ITEM != null and ITEM != ''">
            and ITEM like CONCAT('%', #{ITEM}, '%') 
        </if>
    </where>
    order by MY_SEQNO
  </select>
  <select id="getCount" parameterType="com.EyEmilyKim.dto.TranSearchDto" resultType="Integer">
	select count(TRAN_ID) from MAB_TRANSACTIONS 
	<where>
        USER_ID = #{user_id} 
        <if test="TS_FROM != null">
            AND TRAN_DATE >= #{TS_FROM} 
        </if>
        <if test="TS_TO != null">
            and TRAN_DATE &lt;= #{TS_TO} 
        </if>
        <if test="ITEM != null and ITEM != ''">
            and ITEM like CONCAT('%', #{ITEM}, '%') 
        </if>
    </where>
  </select>
  
</mapper>
